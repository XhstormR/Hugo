<!doctype html><html lang=zh-cn manifest=https://blog.xhstormr.tk/offline.appcache><head><meta charset=utf-8><meta name=renderer content="webkit"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>自学 OpenStack &#183; XhstormR</title><link rel=alternate type=application/rss+xml title=XhstormR href><link rel=icon type=image/x-icon href=https://blog.xhstormr.tk/favicon.ico><link rel=stylesheet href=https://blog.xhstormr.tk/css/uno.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/styles/monokai-sublime.min.css><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js></script><script src=https://blog.xhstormr.tk/js/main.min.js async defer></script></head><body><div id=scriptHeader><span class="mobile btn-mobile-menu"><i class="fa fa-bars btn-mobile-menu__icon"></i>
<i class="fa fa-times btn-mobile-close__icon hidden"></i></span><header class="panel-cover panel-cover--collapsed"><div class=panel-main><div class="panel-main__inner panel-inverted"><div class=panel-main__content><h1 class="panel-cover__title panel-title"><a href=https://blog.xhstormr.tk/ title="link to homepage for XhstormR">XhstormR</a></h1><hr class=panel-cover__divider><p class=panel-cover__description>On a dark desert highway, cool wind in my hair.</p><hr class="panel-cover__divider panel-cover__divider--secondary"><div class=navigation-wrapper><nav class="cover-navigation cover-navigation--primary"><ul class=navigation><li class=navigation__item><a href=https://blog.xhstormr.tk#blog title="link to XhstormR blog" class=blog-button>Blog</a></li></ul></nav></div></div></div><div class=panel-cover--overlay></div></div></header></div><div class=bodytop><div class=content-wrapper><div class=content-wrapper__inner><div class=post><h1>自学 OpenStack</h1><span class=post-date>2016-05-03</span><p>Updated on 2016-05-26</p><blockquote><p><a href=https://www.openstack.org/>https://www.openstack.org/</a></p><p><a href=http://docs.openstack.org/>http://docs.openstack.org/</a></p><p><img src=/uploads/openstack-architecture.png alt title=概念架构>
概念架构 (Conceptual Architecture)</p><p><img src=/uploads/openstack-architecture2.png alt title=逻辑架构>
逻辑架构 (Logical Architecture)</p><p>OpenStack is a cloud operating system that controls large pools of compute, storage, and networking resources throughout a datacenter, all managed through a dashboard that gives administrators control while empowering their users to provision resources through a web interface.</p><p>OpenStack，1化N，通过虚拟化的方式提供灵活高利用率的计算能力。</p><p>Hadoop，N化1，通过分布式文件系统解决单台大机器无法解决的计算和存储问题。</p></blockquote><h2 id=projects>Projects</h2><p><img src=/uploads/openstack-core.png alt></p><h3 id=core-services-6>Core Services (6)</h3><table><thead><tr><th style=text-align:left>NAME</th><th style=text-align:left>SERVICE</th><th></th></tr></thead><tbody><tr><td style=text-align:left>KEYSTONE</td><td style=text-align:left>Identity</td><td style=text-align:left>认证*</td></tr><tr><td style=text-align:left>GLANCE</td><td style=text-align:left>Image</td><td style=text-align:left>镜像*</td></tr><tr><td style=text-align:left>NOVA</td><td style=text-align:left>Compute</td><td style=text-align:left>计算*</td></tr><tr><td style=text-align:left>NEUTRON</td><td style=text-align:left>Networking</td><td style=text-align:left>网络*</td></tr><tr><td style=text-align:left>CINDER</td><td style=text-align:left>Block Storage</td><td style=text-align:left>块存储</td></tr><tr><td style=text-align:left>SWIFT</td><td style=text-align:left>Object Storage</td><td style=text-align:left>对象存储</td></tr><tr><td style=text-align:left>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</td><td style=text-align:left>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;</td><td style=text-align:left>&mdash;&mdash;&mdash;&mdash;</td></tr></tbody></table><h3 id=optional-services-13>Optional Services (13)</h3><table><thead><tr><th style=text-align:left>NAME</th><th style=text-align:left>SERVICE</th><th></th></tr></thead><tbody><tr><td style=text-align:left>Horizon</td><td style=text-align:left>Dashboard</td><td style=text-align:left>面板*</td></tr><tr><td style=text-align:left>Heat</td><td style=text-align:left>Orchestration</td><td style=text-align:left>编配</td></tr><tr><td style=text-align:left>Ceilometer</td><td style=text-align:left>Telemetry</td><td style=text-align:left>监控</td></tr><tr><td style=text-align:left>Sahara</td><td style=text-align:left>Elastic Map Reduce</td><td style=text-align:left>大数据部署</td></tr><tr><td style=text-align:left>&mldr;&mldr;.</td><td style=text-align:left>&mldr;&mldr;.</td><td></td></tr><tr><td style=text-align:left>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</td><td style=text-align:left>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</td><td style=text-align:left>&mdash;&mdash;&mdash;&mdash;&mdash;</td></tr><tr><td style=text-align:left><code>注 * 为本人必须安装项</code></td><td></td><td></td></tr></tbody></table><h2 id=keystone>KEYSTONE</h2><p><img src=/uploads/openstack-keystone.svg alt title=流程></p><ul><li>Keystone：一个公司的安全部门<ul><li>Authentication(认证) 和 Authorization(授权)</li><li>管理用户及其权限</li><li>维护 Service 的 Endpoint</li></ul></li><li>Tenant：安全部门的多个办公室<ul><li>也叫 Project，将 OpenStack 的资源进行分组和隔离，是各个服务中的一些可以访问的资源集合</li><li>资源所有权属于 Project，而不是 User</li><li>所有 User 必须挂在 Project 里才能使用并且共享该 Project 里的资源</li></ul></li><li>User：在办公室上班的员工<ul><li>User 指代任何使用 OpenStack 的实体，可以是用户或程序</li><li>User 可以属于多个 Project，针对每个 Project，User 拥有一个角色(Role)</li></ul></li><li>Role：安全部门内的各种权限 - Authorization(授权)<ul><li>可以为 User 分配多个 Role</li><li>OpenStack 默认定义了 2 种角色<ul><li>member：典型用户</li><li>admin：超级管理用户，对所有 Project 都有完全的权限，相当于 root</li></ul></li></ul></li><li>Service：被安全部门认可的职能<ul><li>Service 通过 Endpoint 暴露自己的 API</li><li>Service 通过<code>policy.json</code>决定每个 Role 能做什么事</li><li><code>policy.json</code>默认只区分<code>admin</code>和非<code>admin</code>Role；若要对特定 Role 进行授权，需要修改<code>policy.json</code></li></ul></li><li>Endpoint：职能办公室的入口<ul><li>User 通过 Endpoint 访问资源和执行操作</li><li>Endpoint 包含 3 种 URL<ul><li>publicURL，可以被全局访问，外网普通服务入口 eg.http://controller:5000/v2.0</li><li>internalURL，只能被局域网访问，内网普通服务入口 eg.http://controller:5000/v2.0</li><li>adminURL，被从常规的访问中分离，内网管理员入口 eg.http://controller:35357/v2.0<ul><li>Keystone 分业务端口(5000)和管理端口(35357)</li></ul></li></ul></li></ul></li><li>Token：访问职能办公室的钥匙<ul><li>User 成功认证后由 Keystone 分配的字符串 - Authentication(认证)</li><li>在与其他服务交互中只需要携带 Token 即可，Token 有效期默认为 24 小时</li></ul></li></ul><pre><code>[root@controller ~]$ ps -e | grep keystone
 2385 ?        00:01:14 keystone-all
</code></pre><h2 id=glance>GLANCE</h2><p><img src=/uploads/openstack-glance.svg alt title=架构></p><ul><li>glance-api：对外提供 REST API，响应 Image 查询、获取和存储的调用<ul><li>glance-api 不会真正处理请求<ul><li>关于 Image Metadata 的相关操作，请求转发给 glance-registry</li><li>关于 Image 自身获取的相关操作，请求转发给该 Image 的 Store backend</li></ul></li></ul></li><li>glance-registry：负责处理和存取 Image 的 Metadata 到 Database 中<ul><li>Glance 支持多种格式的 Image</li><li>Image 的 Metadata 会存储在 Database 中，默认是 MySQL > glance</li></ul></li><li>Store backend：Glance 自己并不存储 Image，真正的 Image 存放在 backed 中<ul><li>Glance 支持多种 backed，默认是<code>Local File System</code>，存储在<code>/var/lib/glance/images</code>中</li><li>除了上图列举出的 backed，还有 GridFS、Ceph、Sheepdog、VMware ESX</li></ul></li></ul><p>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;<img src=/uploads/openstack-glance2.svg alt title="Glance 与 OpenStack 其他 Service 间的关系">&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</p><pre><code>[root@controller ~]$ ps -e | grep glance | sort -uk 4
 2089 ?        00:00:00 glance-api
 2308 ?        00:00:00 glance-registry
</code></pre><h2 id=nova>NOVA</h2><ul><li>nova-api：接收和响应客户的 API 调用</li><li>nova-scheduler：虚拟机调度服务，负责决定在哪个计算节点上运行虚拟机</li><li>nova-compute：管理虚拟机的核心服务，通过调用 Hypervisor API 实现虚拟机生命周期管理</li><li>nova-conductor：代替 nova-compute 访问数据库</li><li>nova-consoleauth：负责对访问虚拟机控制台请求提供 Token 认证</li><li>nova-console：用户可以通过多种方式访问虚拟机的控制台<ul><li>nova-novncproxy：基于 Web 浏览器的 VNC 访问</li><li>nova-spicehtml5proxy：基于 HTML5 浏览器的 SPICE 访问</li><li>nova-xvpnvncproxy：基于 Java 客户端的 VNC 访问</li></ul></li><li>nova-cert：提供 x509 证书支持</li></ul><hr><ul><li>Message Queue(消息队列)：子服务的信息中转站 - Qpid</li><li>Database：MySQL</li></ul><pre><code>* 我采取的是双节点
[root@controller ~]$ ps -e | grep nova | sort -uk 4
 2427 ?        00:01:42 nova-api
 2435 ?        00:00:07 nova-cert
 2443 ?        00:01:40 nova-conductor
 2451 ?        00:00:07 nova-consoleaut
 2459 ?        00:00:02 nova-novncproxy     #nova-console
 2467 ?        00:00:07 nova-scheduler
[root@compute ~]$ ps -e | grep nova | sort -uk 4
 2173 ?        00:01:53 nova-compute
</code></pre></div><div class=sharing style=text-align:center><br><p>捐赠支持</p><p>如果我的文章对你有所帮助，欢迎通过支付宝的扫一扫，轻松的向我发起捐助。</p><p>对于你的支持，我会心怀感激且倍感荣幸地接受，并继续努力。</p><img src=https://ww4.sinaimg.cn/large/a15b4afegw1fbn096ql6dj20dw0dwwe9.jpg alt title data-action=zoom width=40%><p></p><br>&copy; 2015-2020 XhstormR</div></div></div></div><div id=backtop><a href=# title>TOP</a></div><nav id=TableOfContents><ul><li><a href=#projects>Projects</a><ul><li><a href=#core-services-6>Core Services (6)</a></li><li><a href=#optional-services-13>Optional Services (13)</a></li></ul></li><li><a href=#keystone>KEYSTONE</a></li><li><a href=#glance>GLANCE</a></li><li><a href=#nova>NOVA</a></li></ul></nav><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/languages/yaml.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/languages/kotlin.min.js></script><script>hljs.initHighlightingOnLoad()</script><script src=https://blog.xhstormr.tk/js/zoom.min.js></script><script>window.addEventListener("load",show),window.onscroll=show;function show(){document.documentElement.scrollTop+document.body.scrollTop>300?document.getElementById("backtop").style.display="block":document.getElementById("backtop").style.display="none"}</script><script type=text/javascript color=0,0,0 opacity=1 zindex=-2 count=49 src=https://cdnjs.cloudflare.com/ajax/libs/canvas-nest.js/2.0.4/canvas-nest.js></script></body></html>