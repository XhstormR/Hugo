<!doctype html><html lang=zh-cn manifest=https://blog.xhstormr.tk/offline.appcache><head><meta charset=utf-8><meta name=renderer content="webkit"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>Hibernate ORM &#183; XhstormR</title><link rel=alternate type=application/rss+xml title=XhstormR href><link rel=icon type=image/x-icon href=https://blog.xhstormr.tk/favicon.ico><link rel=stylesheet href=https://blog.xhstormr.tk/css/uno.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/styles/monokai-sublime.min.css><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js></script><script src=https://blog.xhstormr.tk/js/main.min.js async defer></script></head><body><div id=scriptHeader><span class="mobile btn-mobile-menu"><i class="fa fa-bars btn-mobile-menu__icon"></i>
<i class="fa fa-times btn-mobile-close__icon hidden"></i></span><header class="panel-cover panel-cover--collapsed"><div class=panel-main><div class="panel-main__inner panel-inverted"><div class=panel-main__content><h1 class="panel-cover__title panel-title"><a href=https://blog.xhstormr.tk/ title="link to homepage for XhstormR">XhstormR</a></h1><hr class=panel-cover__divider><p class=panel-cover__description>On a dark desert highway, cool wind in my hair.</p><hr class="panel-cover__divider panel-cover__divider--secondary"><div class=navigation-wrapper><nav class="cover-navigation cover-navigation--primary"><ul class=navigation><li class=navigation__item><a href=https://blog.xhstormr.tk#blog title="link to XhstormR blog" class=blog-button>Blog</a></li></ul></nav></div></div></div><div class=panel-cover--overlay></div></div></header></div><div class=bodytop><div class=content-wrapper><div class=content-wrapper__inner><div class=post><h1>Hibernate ORM</h1><span class=post-date>2017-05-14</span><p>Updated on 2017-05-14</p><blockquote><p style=text-align:center><img data-src=/uploads/hibernate.png alt title=Hibernate data-action=zoom width></p><script>[].forEach.call(document.querySelectorAll("img[data-src]"),function(a){a.setAttribute("src",a.getAttribute("data-src")),a.onload=function(){a.removeAttribute("data-src")}})</script><p><a href=https://hibernate.org/orm/>https://hibernate.org/orm/</a></p><p><a href=https://github.com/hibernate/hibernate-orm>https://github.com/hibernate/hibernate-orm</a></p><p><a href=https://docs.jboss.org/hibernate/orm/current/javadocs/allclasses-noframe.html>https://docs.jboss.org/hibernate/orm/current/javadocs/allclasses-noframe.html</a></p><p><a href=https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html>https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html</a></p><p><a href=https://www.postgresql.org/docs/current/static/index.html>https://www.postgresql.org/docs/current/static/index.html</a></p><p><a href=https://jcenter.bintray.com/org/hibernate/hibernate-core/>https://jcenter.bintray.com/org/hibernate/hibernate-core/</a></p></blockquote><h2 id=configuration>Configuration</h2><h3 id=buildgradlekts>build.gradle.kts</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>compile<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;org.postgresql:postgresql:+&#34;</span><span style=color:#f92672>)</span>
compile<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;org.hibernate:hibernate-core:+&#34;</span><span style=color:#f92672>)</span>
</code></pre></div><h3 id=hibernatecfgxml>hibernate.cfg.xml</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#75715e>&lt;?xml version=&#39;1.0&#39; encoding=&#39;utf-8&#39;?&gt;</span>
<span style=color:#75715e>&lt;!DOCTYPE hibernate-configuration PUBLIC
</span><span style=color:#75715e>        &#34;-//Hibernate/Hibernate Configuration DTD//EN&#34;
</span><span style=color:#75715e>        &#34;http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd&#34;&gt;</span>
<span style=color:#f92672>&lt;hibernate-configuration&gt;</span>
    <span style=color:#f92672>&lt;session-factory&gt;</span>
        <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;dialect&#34;</span><span style=color:#f92672>&gt;</span>org.hibernate.dialect.PostgreSQL95Dialect<span style=color:#f92672>&lt;/property&gt;</span>
        <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;connection.url&#34;</span><span style=color:#f92672>&gt;</span>jdbc:postgresql://127.0.0.1:5432/postgres<span style=color:#f92672>&lt;/property&gt;</span>
        <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;connection.driver_class&#34;</span><span style=color:#f92672>&gt;</span>org.postgresql.Driver<span style=color:#f92672>&lt;/property&gt;</span>
        <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;connection.username&#34;</span><span style=color:#f92672>&gt;</span>123<span style=color:#f92672>&lt;/property&gt;</span>
        <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;connection.password&#34;</span><span style=color:#f92672>&gt;</span>123456<span style=color:#f92672>&lt;/property&gt;</span>

        <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;show_sql&#34;</span><span style=color:#f92672>&gt;</span>true<span style=color:#f92672>&lt;/property&gt;</span>
        <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;format_sql&#34;</span><span style=color:#f92672>&gt;</span>false<span style=color:#f92672>&lt;/property&gt;</span>

        <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;hbm2ddl.auto&#34;</span><span style=color:#f92672>&gt;</span>update<span style=color:#f92672>&lt;/property&gt;</span>

        <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;current_session_context_class&#34;</span><span style=color:#f92672>&gt;</span>thread<span style=color:#f92672>&lt;/property&gt;</span>

        <span style=color:#f92672>&lt;mapping</span> <span style=color:#a6e22e>class=</span><span style=color:#e6db74>&#34;entity.Student&#34;</span><span style=color:#f92672>/&gt;</span>     实体
    <span style=color:#f92672>&lt;/session-factory&gt;</span>
<span style=color:#f92672>&lt;/hibernate-configuration&gt;</span>

hbm2ddl.auto（DDL 生成策略）：
     create：启动时重新创建表。
create-drop：启动时重新创建表，结束时再删除表。
     update：启动时验证表结构，不一致时，更新表结构。
   validate：启动时验证表结构，不一致时，抛出异常。

current_session_context_class ➜ thread ➜ org.hibernate.context.internal.ThreadLocalSessionContext
</code></pre></div><h2 id=单表操作>单表操作</h2><h3 id=entity>entity</h3><h4 id=student>Student</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>package</span> entity

<span style=color:#66d9ef>import</span> java.util.*
<span style=color:#66d9ef>import</span> javax.persistence.*     JPA <span style=color:#960050;background-color:#1e0010>注解</span>

<span style=color:#a6e22e>@Entity</span>     <span style=color:#960050;background-color:#1e0010>实体</span>
<span style=color:#66d9ef>data</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Student</span>(
        <span style=color:#a6e22e>@Id</span>     <span style=color:#960050;background-color:#1e0010>主键</span>
        <span style=color:#a6e22e>@GeneratedValue</span>(strategy = GenerationType.IDENTITY)     <span style=color:#960050;background-color:#1e0010>主键整形自增（</span>SERIAL<span style=color:#960050;background-color:#1e0010>）</span>
        <span style=color:#66d9ef>var</span> id: Int? = <span style=color:#66d9ef>null</span>,
        <span style=color:#66d9ef>var</span> name: String? = <span style=color:#66d9ef>null</span>,
        <span style=color:#66d9ef>var</span> gender: String? = <span style=color:#66d9ef>null</span>,
        <span style=color:#66d9ef>var</span> birthday: Date? = <span style=color:#66d9ef>null</span>,
        <span style=color:#66d9ef>var</span> address: Address? = <span style=color:#66d9ef>null</span>,     <span style=color:#960050;background-color:#1e0010>组件</span>
        <span style=color:#66d9ef>var</span> picture: ByteArray? = <span style=color:#66d9ef>null</span>,
        <span style=color:#a6e22e>@Transient</span>     <span style=color:#960050;background-color:#1e0010>非字段</span>
        <span style=color:#66d9ef>var</span> temp: String? = <span style=color:#66d9ef>null</span>
)

<span style=color:#a6e22e>@Table</span>(name = <span style=color:#e6db74>&#34;t_student&#34;</span>)     <span style=color:#960050;background-color:#1e0010>定义表</span>

<span style=color:#a6e22e>@Column</span>(nullable = <span style=color:#66d9ef>false</span>, columnDefinition = <span style=color:#e6db74>&#34;timestamp|time|date&#34;</span>)     <span style=color:#960050;background-color:#1e0010>定义字段</span>

<span style=color:#a6e22e>@Temporal</span>(TemporalType.DATE)
timestamp  <span style=color:#960050;background-color:#1e0010>时间</span>+<span style=color:#960050;background-color:#1e0010>日期</span>
time       <span style=color:#960050;background-color:#1e0010>时间</span>
date       <span style=color:#960050;background-color:#1e0010>日期</span>
</code></pre></div><h4 id=address>Address</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>package</span> entity

<span style=color:#66d9ef>import</span> javax.persistence.Embeddable

<span style=color:#a6e22e>@Embeddable</span>     <span style=color:#960050;background-color:#1e0010>组件</span>
<span style=color:#66d9ef>data</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Address</span>(
        <span style=color:#66d9ef>var</span> city: String? = <span style=color:#66d9ef>null</span>,
        <span style=color:#66d9ef>var</span> phone: String? = <span style=color:#66d9ef>null</span>,
        <span style=color:#66d9ef>var</span> postcode: String? = <span style=color:#66d9ef>null</span>
)
</code></pre></div><h3 id=a>A</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>import</span> entity.Address
<span style=color:#66d9ef>import</span> entity.Student
<span style=color:#66d9ef>import</span> org.hibernate.SessionFactory
<span style=color:#66d9ef>import</span> org.hibernate.boot.MetadataSources
<span style=color:#66d9ef>import</span> org.hibernate.boot.registry.StandardServiceRegistryBuilder
<span style=color:#66d9ef>import</span> java.util.*

<span style=color:#66d9ef>val</span> sessionFactory: SessionFactory <span style=color:#66d9ef>by</span> lazy {     <span style=color:#960050;background-color:#1e0010>会话工厂</span>
    <span style=color:#66d9ef>val</span> registry = StandardServiceRegistryBuilder().configure().build()
    MetadataSources(registry).buildMetadata().buildSessionFactory()
}

<span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>main</span>(args: Array&lt;String&gt;) {
    create()
    retrieve()
    update()
    delete()
    sessionFactory.close()
}

<span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>create</span>() {
    println(<span style=color:#e6db74>&#34;增&#34;</span>)
    sessionFactory.currentSession.use {
        <span style=color:#66d9ef>it</span>.beginTransaction()     <span style=color:#960050;background-color:#1e0010>开启事务</span>
        <span style=color:#66d9ef>val</span> student = Student(name = <span style=color:#e6db74>&#34;张三丰&#34;</span>, gender = <span style=color:#e6db74>&#34;男&#34;</span>, birthday = Date(), address = Address(city = <span style=color:#e6db74>&#34;重庆&#34;</span>))
        <span style=color:#66d9ef>it</span>.save(student)
        <span style=color:#66d9ef>it</span>.transaction.commit()     <span style=color:#960050;background-color:#1e0010>提交事务</span>
    }

          openSession()<span style=color:#960050;background-color:#1e0010>：新建会话，会话需手动关闭。</span>
    getCurrentSession()<span style=color:#960050;background-color:#1e0010>：重用会话，会话会自动关闭。（需要配置</span> current_session_context_class<span style=color:#960050;background-color:#1e0010>）</span>
}

<span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>retrieve</span>() {
    println(<span style=color:#e6db74>&#34;查&#34;</span>)
    sessionFactory.currentSession.use {
        <span style=color:#66d9ef>it</span>.beginTransaction()
        <span style=color:#66d9ef>val</span> student = <span style=color:#66d9ef>it</span>.<span style=color:#66d9ef>get</span>(Student<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java, <span style=color:#ae81ff>1</span>)
        println(student)
        <span style=color:#66d9ef>it</span>.transaction.commit()
    }

     <span style=color:#66d9ef>get</span>()<span style=color:#960050;background-color:#1e0010>：立即执行</span> SQL <span style=color:#960050;background-color:#1e0010>语句，返回实体对象，记录不存在返回</span> <span style=color:#66d9ef>null</span><span style=color:#960050;background-color:#1e0010>。（</span>Eager<span style=color:#960050;background-color:#1e0010>）</span>
    load()<span style=color:#960050;background-color:#1e0010>：延迟执行</span> SQL <span style=color:#960050;background-color:#1e0010>语句，返回代理对象，记录不存在抛出</span> ObjectNotFoundException <span style=color:#960050;background-color:#1e0010>异常。（</span>Lazy<span style=color:#960050;background-color:#1e0010>）</span>
}

<span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>update</span>() {
    println(<span style=color:#e6db74>&#34;改&#34;</span>)
    sessionFactory.currentSession.use {
        <span style=color:#66d9ef>it</span>.beginTransaction()
        <span style=color:#66d9ef>val</span> student = <span style=color:#66d9ef>it</span>.<span style=color:#66d9ef>get</span>(Student<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java, <span style=color:#ae81ff>1</span>)<span style=color:#f92672>?.</span>apply { <span style=color:#66d9ef>this</span>.gender = <span style=color:#e6db74>&#34;女&#34;</span> }
        <span style=color:#66d9ef>if</span> (student <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span>) {
            <span style=color:#66d9ef>it</span>.update(student)
        }
        <span style=color:#66d9ef>it</span>.transaction.commit()
    }
}

<span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>delete</span>() {
    println(<span style=color:#e6db74>&#34;删&#34;</span>)
    sessionFactory.currentSession.use {
        <span style=color:#66d9ef>it</span>.beginTransaction()
        <span style=color:#66d9ef>val</span> student = <span style=color:#66d9ef>it</span>.<span style=color:#66d9ef>get</span>(Student<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java, <span style=color:#ae81ff>1</span>)
        <span style=color:#66d9ef>if</span> (student <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span>) {
            <span style=color:#66d9ef>it</span>.delete(student)
        }
        <span style=color:#66d9ef>it</span>.transaction.commit()
    }
}
</code></pre></div><h2 id=多表关联>多表关联</h2><h3 id=一对一>一对一</h3><p>只需持久化一方（Phone）。</p><h4 id=单向引用>单向引用</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>import</span> javax.persistence.*     JPA <span style=color:#960050;background-color:#1e0010>注解</span>

<span style=color:#a6e22e>@Entity</span>
<span style=color:#66d9ef>data</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Phone</span>(     <span style=color:#960050;background-color:#1e0010>从表</span>
        <span style=color:#a6e22e>@Id</span>
        <span style=color:#a6e22e>@GeneratedValue</span>(strategy = GenerationType.IDENTITY)
        <span style=color:#66d9ef>val</span> id: Int? = <span style=color:#66d9ef>null</span>,
        <span style=color:#a6e22e>@Column</span>(unique = <span style=color:#66d9ef>true</span>)     <span style=color:#960050;background-color:#1e0010>定义字段</span>
        <span style=color:#66d9ef>var</span> number: String? = <span style=color:#66d9ef>null</span>,
        <span style=color:#a6e22e>@OneToOne</span>(cascade = arrayOf(CascadeType.ALL), orphanRemoval = <span style=color:#66d9ef>true</span>)
        <span style=color:#a6e22e>@JoinColumn</span>(unique = <span style=color:#66d9ef>true</span>)     <span style=color:#960050;background-color:#1e0010>定义外键字段</span>
        <span style=color:#66d9ef>var</span> details: PhoneDetail? = <span style=color:#66d9ef>null</span>     <span style=color:#960050;background-color:#1e0010>将</span> PhoneDetail <span style=color:#960050;background-color:#1e0010>的主键作为此表的外键</span>
)

<span style=color:#f92672>----</span>

<span style=color:#a6e22e>@Entity</span>
<span style=color:#66d9ef>data</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PhoneDetail</span>(     <span style=color:#960050;background-color:#1e0010>主表（与平常状态一致，无需改动）</span>
        <span style=color:#a6e22e>@Id</span>
        <span style=color:#a6e22e>@GeneratedValue</span>(strategy = GenerationType.IDENTITY)
        <span style=color:#66d9ef>val</span> id: Int? = <span style=color:#66d9ef>null</span>,
        <span style=color:#66d9ef>var</span> provider: String? = <span style=color:#66d9ef>null</span>
)
</code></pre></div><h4 id=双向引用优>双向引用（优）</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#a6e22e>@Entity</span>
<span style=color:#66d9ef>data</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Phone</span>(     <span style=color:#960050;background-color:#1e0010>主表</span>
        <span style=color:#a6e22e>@Id</span>
        <span style=color:#a6e22e>@GeneratedValue</span>(strategy = GenerationType.IDENTITY)
        <span style=color:#66d9ef>val</span> id: Int? = <span style=color:#66d9ef>null</span>,
        <span style=color:#a6e22e>@Column</span>(unique = <span style=color:#66d9ef>true</span>)
        <span style=color:#66d9ef>var</span> number: String? = <span style=color:#66d9ef>null</span>,
        <span style=color:#a6e22e>@OneToOne</span>(mappedBy = <span style=color:#e6db74>&#34;phone&#34;</span>, cascade = arrayOf(CascadeType.ALL), orphanRemoval = <span style=color:#66d9ef>true</span>)
        <span style=color:#66d9ef>var</span> details: PhoneDetail? = <span style=color:#66d9ef>null</span>     <span style=color:#960050;background-color:#1e0010>由</span> PhoneDetail <span style=color:#960050;background-color:#1e0010>中的</span> phone <span style=color:#960050;background-color:#1e0010>负责关联</span>
) {
    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>addDetails</span>(details: PhoneDetail) {     <span style=color:#960050;background-color:#1e0010>确保双方关系保持同步</span>
        <span style=color:#66d9ef>this</span>.details = details
        details.phone = <span style=color:#66d9ef>this</span>
    }

    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>removeDetails</span>() {     <span style=color:#960050;background-color:#1e0010>确保双方关系保持同步</span>
        <span style=color:#66d9ef>if</span> (details <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span>) {
            <span style=color:#66d9ef>this</span>.details = <span style=color:#66d9ef>null</span>
            details<span style=color:#f92672>?.</span>phone = <span style=color:#66d9ef>null</span>
        }
    }
}

<span style=color:#f92672>----</span>

<span style=color:#a6e22e>@Entity</span>
<span style=color:#66d9ef>data</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PhoneDetail</span>(     <span style=color:#960050;background-color:#1e0010>从表</span>
        <span style=color:#a6e22e>@Id</span>
        <span style=color:#a6e22e>@GeneratedValue</span>(strategy = GenerationType.IDENTITY)
        <span style=color:#66d9ef>val</span> id: Int? = <span style=color:#66d9ef>null</span>,
        <span style=color:#66d9ef>var</span> provider: String? = <span style=color:#66d9ef>null</span>,
        <span style=color:#a6e22e>@OneToOne</span>
        <span style=color:#a6e22e>@JoinColumn</span>(unique = <span style=color:#66d9ef>true</span>)
        <span style=color:#66d9ef>var</span> phone: Phone? = <span style=color:#66d9ef>null</span>     <span style=color:#960050;background-color:#1e0010>将</span> Phone <span style=color:#960050;background-color:#1e0010>的主键作为此表的外键</span>
)
</code></pre></div><h3 id=一对多>一对多</h3><p>只需持久化一方（Person）。</p><h4 id=单向引用一方持有多方集合>单向引用（一方持有多方集合）</h4><p>会生成中间表 Person_Phone 来关联两个实体。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#a6e22e>@Entity</span>
<span style=color:#66d9ef>data</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Person</span>(
        <span style=color:#a6e22e>@Id</span>
        <span style=color:#a6e22e>@GeneratedValue</span>(strategy = GenerationType.IDENTITY)
        <span style=color:#66d9ef>val</span> id: Int? = <span style=color:#66d9ef>null</span>,
        <span style=color:#66d9ef>var</span> name: String? = <span style=color:#66d9ef>null</span>,
        <span style=color:#a6e22e>@OneToMany</span>(cascade = arrayOf(CascadeType.ALL), orphanRemoval = <span style=color:#66d9ef>true</span>)
        <span style=color:#66d9ef>val</span> phones: MutableList&lt;Phone&gt; = arrayListOf()
)

<span style=color:#f92672>----</span>

<span style=color:#a6e22e>@Entity</span>
<span style=color:#66d9ef>data</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Phone</span>(     <span style=color:#960050;background-color:#1e0010>与平常状态一致，无需改动</span>
        <span style=color:#a6e22e>@Id</span>
        <span style=color:#a6e22e>@GeneratedValue</span>(strategy = GenerationType.IDENTITY)
        <span style=color:#66d9ef>val</span> id: Int? = <span style=color:#66d9ef>null</span>,
        <span style=color:#a6e22e>@Column</span>(unique = <span style=color:#66d9ef>true</span>)
        <span style=color:#66d9ef>var</span> number: String? = <span style=color:#66d9ef>null</span>
)
</code></pre></div><h3 id=多对一>多对一</h3><p>因未设置级联属性，在不同事务中，需先持久化 <strong>主表</strong> Person，后持久化<strong>从表</strong> Phone。( 先主后从 )</p><h4 id=单向引用多方持有一方引用>单向引用（多方持有一方引用）</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#a6e22e>@Entity</span>
<span style=color:#66d9ef>data</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Person</span>(     <span style=color:#960050;background-color:#1e0010>主表（与平常状态一致，无需改动）</span>
        <span style=color:#a6e22e>@Id</span>
        <span style=color:#a6e22e>@GeneratedValue</span>(strategy = GenerationType.IDENTITY)
        <span style=color:#66d9ef>val</span> id: Int? = <span style=color:#66d9ef>null</span>,
        <span style=color:#66d9ef>var</span> name: String? = <span style=color:#66d9ef>null</span>
)

<span style=color:#f92672>----</span>

<span style=color:#a6e22e>@Entity</span>
<span style=color:#66d9ef>data</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Phone</span>(     <span style=color:#960050;background-color:#1e0010>从表</span>
        <span style=color:#a6e22e>@Id</span>
        <span style=color:#a6e22e>@GeneratedValue</span>(strategy = GenerationType.IDENTITY)
        <span style=color:#66d9ef>val</span> id: Int? = <span style=color:#66d9ef>null</span>,
        <span style=color:#a6e22e>@Column</span>(unique = <span style=color:#66d9ef>true</span>)
        <span style=color:#66d9ef>var</span> number: String? = <span style=color:#66d9ef>null</span>,
        <span style=color:#a6e22e>@ManyToOne</span>
        <span style=color:#66d9ef>var</span> person: Person? = <span style=color:#66d9ef>null</span>     <span style=color:#960050;background-color:#1e0010>将</span> Person <span style=color:#960050;background-color:#1e0010>的主键作为此表的外键</span>
)
</code></pre></div><h3 id=一多对多一>一（多）对多（一）</h3><p>只需持久化一方（Person）。</p><h4 id=双向引用优-1>双向引用（优）</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#a6e22e>@Entity</span>
<span style=color:#66d9ef>data</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Person</span>(     <span style=color:#960050;background-color:#1e0010>主表</span>
        <span style=color:#a6e22e>@Id</span>
        <span style=color:#a6e22e>@GeneratedValue</span>(strategy = GenerationType.IDENTITY)
        <span style=color:#66d9ef>val</span> id: Int? = <span style=color:#66d9ef>null</span>,
        <span style=color:#66d9ef>var</span> name: String? = <span style=color:#66d9ef>null</span>,
        <span style=color:#a6e22e>@OneToMany</span>(mappedBy = <span style=color:#e6db74>&#34;person&#34;</span>, cascade = arrayOf(CascadeType.ALL), orphanRemoval = <span style=color:#66d9ef>true</span>)
        <span style=color:#66d9ef>val</span> phones: MutableList&lt;Phone&gt; = arrayListOf()     <span style=color:#960050;background-color:#1e0010>由</span> Phone <span style=color:#960050;background-color:#1e0010>中的</span> person <span style=color:#960050;background-color:#1e0010>负责关联</span>
) {
    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>addPhone</span>(phone: Phone) {     <span style=color:#960050;background-color:#1e0010>确保双方关系保持同步</span>
        phones.add(phone)
        phone.person = <span style=color:#66d9ef>this</span>
    }

    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>removePhone</span>(phone: Phone) {     <span style=color:#960050;background-color:#1e0010>确保双方关系保持同步</span>
        phones.remove(phone)
        phone.person = <span style=color:#66d9ef>null</span>
    }
}

<span style=color:#f92672>----</span>

<span style=color:#a6e22e>@Entity</span>
<span style=color:#66d9ef>data</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Phone</span>(     <span style=color:#960050;background-color:#1e0010>从表</span>
        <span style=color:#a6e22e>@Id</span>
        <span style=color:#a6e22e>@GeneratedValue</span>(strategy = GenerationType.IDENTITY)
        <span style=color:#66d9ef>val</span> id: Int? = <span style=color:#66d9ef>null</span>,
        <span style=color:#a6e22e>@Column</span>(unique = <span style=color:#66d9ef>true</span>)
        <span style=color:#66d9ef>var</span> number: String? = <span style=color:#66d9ef>null</span>,
        <span style=color:#a6e22e>@ManyToOne</span>
        <span style=color:#66d9ef>var</span> person: Person? = <span style=color:#66d9ef>null</span>     <span style=color:#960050;background-color:#1e0010>将</span> Person <span style=color:#960050;background-color:#1e0010>的主键作为此表的外键</span>
)
</code></pre></div><h3 id=多对多略>多对多（略）</h3><h2 id=reference>Reference</h2><ul><li><a href=https://en.wikibooks.org/wiki/Java_Persistence/Relationships>https://en.wikibooks.org/wiki/Java_Persistence/Relationships</a></li><li>domain<ul><li><a href=https://docs.jboss.org/hibernate/orm/current/userguide/html_single/chapters/domain/associations.html>associations</a></li><li><a href=https://docs.jboss.org/hibernate/orm/current/userguide/html_single/chapters/domain/collections.html>collections</a></li></ul></li><li>appendices<ul><li><a href=https://docs.jboss.org/hibernate/orm/current/userguide/html_single/appendices/Annotations.html>Annotations</a></li><li><a href=https://docs.jboss.org/hibernate/orm/current/userguide/html_single/appendices/BestPractices.html>BestPractices</a></li><li><a href=https://docs.jboss.org/hibernate/orm/current/userguide/html_single/appendices/Configurations.html>Configurations</a></li></ul></li><li>JPA API<ul><li><a href=https://www.oracle.com/webfolder/technetwork/jsc/xml/ns/persistence/index.html>https://www.oracle.com/webfolder/technetwork/jsc/xml/ns/persistence/index.html</a></li><li><a href=https://www.oracle.com/technetwork/cn/middleware/ias/toplink-jpa-annotations-100895-zhs.html>https://www.oracle.com/technetwork/cn/middleware/ias/toplink-jpa-annotations-100895-zhs.html</a></li><li><a href=https://github.com/datanucleus/docs-accessplatform/blob/master/src/main/asciidoc/jpa/annotations.adoc>Annotations</a></li><li><a href=https://github.com/datanucleus/docs-accessplatform/blob/master/src/main/asciidoc/jpa/metadata_xml.adoc>XML</a></li></ul></li></ul></div><div class=sharing style=text-align:center><br><p>捐赠支持</p><p>如果我的文章对你有所帮助，欢迎通过支付宝的扫一扫，轻松的向我发起捐助。</p><p>对于你的支持，我会心怀感激且倍感荣幸地接受，并继续努力。</p><img src=https://ww4.sinaimg.cn/large/a15b4afegw1fbn096ql6dj20dw0dwwe9.jpg alt title data-action=zoom width=40%><p></p><br>&copy; 2015-2020 XhstormR</div></div></div></div><div id=backtop><a href=# title>TOP</a></div><nav id=TableOfContents><ul><li><a href=#configuration>Configuration</a><ul><li><a href=#buildgradlekts>build.gradle.kts</a></li><li><a href=#hibernatecfgxml>hibernate.cfg.xml</a></li></ul></li><li><a href=#单表操作>单表操作</a><ul><li><a href=#entity>entity</a></li><li><a href=#a>A</a></li></ul></li><li><a href=#多表关联>多表关联</a><ul><li><a href=#一对一>一对一</a></li><li><a href=#一对多>一对多</a></li><li><a href=#多对一>多对一</a></li><li><a href=#一多对多一>一（多）对多（一）</a></li><li><a href=#多对多略>多对多（略）</a></li></ul></li><li><a href=#reference>Reference</a></li></ul></nav><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/languages/yaml.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/languages/kotlin.min.js></script><script>hljs.initHighlightingOnLoad()</script><script src=https://blog.xhstormr.tk/js/zoom.min.js></script><script>window.addEventListener("load",show),window.onscroll=show;function show(){document.documentElement.scrollTop+document.body.scrollTop>300?document.getElementById("backtop").style.display="block":document.getElementById("backtop").style.display="none"}</script><script type=text/javascript color=0,0,0 opacity=1 zindex=-2 count=49 src=https://cdnjs.cloudflare.com/ajax/libs/canvas-nest.js/2.0.4/canvas-nest.js></script></body></html>