<!doctype html><html lang=zh-cn manifest=https://blog.xhstormr.tk/offline.appcache><head><meta charset=utf-8><meta name=renderer content="webkit"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>Android Handler &#183; XhstormR</title><link rel=alternate type=application/rss+xml title=XhstormR href><link rel=icon type=image/x-icon href=https://blog.xhstormr.tk/favicon.ico><link rel=stylesheet href=https://blog.xhstormr.tk/css/uno.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/styles/monokai-sublime.min.css><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js></script><script src=https://blog.xhstormr.tk/js/main.min.js async defer></script></head><body><div id=scriptHeader><span class="mobile btn-mobile-menu"><i class="fa fa-bars btn-mobile-menu__icon"></i>
<i class="fa fa-times btn-mobile-close__icon hidden"></i></span><header class="panel-cover panel-cover--collapsed"><div class=panel-main><div class="panel-main__inner panel-inverted"><div class=panel-main__content><h1 class="panel-cover__title panel-title"><a href=https://blog.xhstormr.tk/ title="link to homepage for XhstormR">XhstormR</a></h1><hr class=panel-cover__divider><p class=panel-cover__description>On a dark desert highway, cool wind in my hair.</p><hr class="panel-cover__divider panel-cover__divider--secondary"><div class=navigation-wrapper><nav class="cover-navigation cover-navigation--primary"><ul class=navigation><li class=navigation__item><a href=https://blog.xhstormr.tk#blog title="link to XhstormR blog" class=blog-button>Blog</a></li></ul></nav></div></div></div><div class=panel-cover--overlay></div></div></header></div><div class=bodytop><div class=content-wrapper><div class=content-wrapper__inner><div class=post><h1>Android Handler</h1><span class=post-date>2016-10-25</span><p>Updated on 2016-10-29</p><blockquote><p style=text-align:center><img data-src=/uploads/android-handler.svg alt title="Handler 机制" data-action=zoom width></p><script>[].forEach.call(document.querySelectorAll("img[data-src]"),function(a){a.setAttribute("src",a.getAttribute("data-src")),a.onload=function(){a.removeAttribute("data-src")}})</script><p><a href=http://download.java.net/jdk/jdk-api-localizations/jdk-api-zh-cn/publish/1.6.0/html/zh_CN/api/java/lang/ThreadLocal.html>ThreadLocal</a></p><p><a href=http://download.java.net/jdk/jdk-api-localizations/jdk-api-zh-cn/publish/1.6.0/html/zh_CN/api/java/lang/ref/WeakReference.html>WeakReference</a></p><p><a href=http://www.sourceinsight.com/down35.html>Source Insight</a></p></blockquote><ul><li>Handler：负责发送和处理 Message。</li><li>ThreadLocal：负责保存 Looper，作为线程的局部变量。<ul><li>Looper：负责接收并转发 Message。<ul><li>MessageQueue：负责存储 Message 的容器。</li></ul></li></ul></li></ul><h2 id=post--runnable>post ➜ Runnable</h2><h3 id=mainactivityjava>MainActivity.java</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MainActivity</span> <span style=color:#66d9ef>extends</span> Activity <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>private</span> ImageView mImageView<span style=color:#f92672>;</span>
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Handler mHandler <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Handler<span style=color:#f92672>();</span>
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Runnable mRunnable <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Runnable<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>     A<span style=color:#960050;background-color:#1e0010>：</span>第一种<span style=color:#960050;background-color:#1e0010>（</span>postDelayed<span style=color:#960050;background-color:#1e0010>）</span>
        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>[]</span> colors <span style=color:#f92672>=</span> <span style=color:#f92672>{</span>Color<span style=color:#f92672>.</span><span style=color:#a6e22e>parseColor</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;red&#34;</span><span style=color:#f92672>),</span> Color<span style=color:#f92672>.</span><span style=color:#a6e22e>parseColor</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;blue&#34;</span><span style=color:#f92672>),</span> Color<span style=color:#f92672>.</span><span style=color:#a6e22e>parseColor</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;green&#34;</span><span style=color:#f92672>)};</span>     颜色
        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> index<span style=color:#f92672>;</span>     索引

        <span style=color:#a6e22e>@Override</span>
        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>run</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
            index<span style=color:#f92672>++;</span>
            index <span style=color:#f92672>%=</span> 3<span style=color:#f92672>;</span>
            mImageView<span style=color:#f92672>.</span><span style=color:#a6e22e>setBackgroundColor</span><span style=color:#f92672>(</span>colors<span style=color:#f92672>[</span>index<span style=color:#f92672>]);</span>     设置背景颜色
            mHandler<span style=color:#f92672>.</span><span style=color:#a6e22e>postDelayed</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>,</span> 1000<span style=color:#f92672>);</span>     封装线程体为 Message 中的 callback<span style=color:#960050;background-color:#1e0010>，</span>再传递至 Looper 中的 MessageQueue<span style=color:#960050;background-color:#1e0010>，</span>并延迟 1 秒后执行
        <span style=color:#f92672>}</span>                                           <span style=color:#960050;background-color:#1e0010>↳</span> 使用了递归思想<span style=color:#960050;background-color:#1e0010>，</span>无限循环
    <span style=color:#f92672>};</span>
    <span style=color:#66d9ef>private</span> Thread mThread <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Thread<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>     B<span style=color:#960050;background-color:#1e0010>：</span>第二种<span style=color:#960050;background-color:#1e0010>（</span>post<span style=color:#960050;background-color:#1e0010>）</span>
        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>[]</span> colors <span style=color:#f92672>=</span> <span style=color:#f92672>{</span>Color<span style=color:#f92672>.</span><span style=color:#a6e22e>parseColor</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;red&#34;</span><span style=color:#f92672>),</span> Color<span style=color:#f92672>.</span><span style=color:#a6e22e>parseColor</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;blue&#34;</span><span style=color:#f92672>),</span> Color<span style=color:#f92672>.</span><span style=color:#a6e22e>parseColor</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;green&#34;</span><span style=color:#f92672>)};</span>     颜色

        <span style=color:#a6e22e>@Override</span>
        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>run</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
            <span style=color:#66d9ef>while</span> <span style=color:#f92672>(!</span>Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>interrupted</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>     判断线程是否为中断状态
                <span style=color:#a6e22e>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> color <span style=color:#f92672>:</span> colors<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>     遍历颜色
                    mHandler<span style=color:#f92672>.</span><span style=color:#a6e22e>post</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> Runnable<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>     封装线程体为 Message 中的 callback<span style=color:#960050;background-color:#1e0010>，</span>再传递至 Looper 中的 MessageQueue
                        <span style=color:#a6e22e>@Override</span>
                        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>run</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
                            mImageView<span style=color:#f92672>.</span><span style=color:#a6e22e>setBackgroundColor</span><span style=color:#f92672>(</span>color<span style=color:#f92672>);</span>     设置背景颜色
                        <span style=color:#f92672>}</span>
                    <span style=color:#f92672>});</span>
                    <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
                        Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span>1000<span style=color:#f92672>);</span>     当前线程进入阻塞状态 1 秒
                    <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>InterruptedException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>     阻塞状态下中断线程将引发该异常<span style=color:#960050;background-color:#1e0010>，</span>且中断状态将被清除
                        <span style=color:#66d9ef>return</span><span style=color:#f92672>;</span>     直接返回
                    <span style=color:#f92672>}</span>
                <span style=color:#f92672>}</span>
            <span style=color:#f92672>}</span>
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>};</span>

    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onCreate</span><span style=color:#f92672>(</span>Bundle savedInstanceState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onCreate</span><span style=color:#f92672>(</span>savedInstanceState<span style=color:#f92672>);</span>
        setContentView<span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>layout</span><span style=color:#f92672>.</span><span style=color:#a6e22e>activity_main</span><span style=color:#f92672>);</span>

        mImageView <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>ImageView<span style=color:#f92672>)</span> findViewById<span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>imageView</span><span style=color:#f92672>);</span>     需实现每隔 1 秒更换此 ImageView 背景颜色
    <span style=color:#f92672>}</span>

    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onDestroy</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onDestroy</span><span style=color:#f92672>();</span>
        mHandler<span style=color:#f92672>.</span><span style=color:#a6e22e>removeCallbacksAndMessages</span><span style=color:#f92672>(</span><span style=color:#66d9ef>null</span><span style=color:#f92672>);</span>     A 移除 Looper 中的 MessageQueue 中所有等待处理的 Message
        mThread<span style=color:#f92672>.</span><span style=color:#a6e22e>interrupt</span><span style=color:#f92672>();</span>     B 中断线程
    <span style=color:#f92672>}</span>

    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onClick</span><span style=color:#f92672>(</span>View view<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>     A
        <span style=color:#a6e22e>switch</span> <span style=color:#f92672>(</span>view<span style=color:#f92672>.</span><span style=color:#a6e22e>getId</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
            <span style=color:#66d9ef>case</span> R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>button1</span><span style=color:#f92672>:</span>
                mHandler<span style=color:#f92672>.</span><span style=color:#a6e22e>post</span><span style=color:#f92672>(</span>mRunnable<span style=color:#f92672>);</span>     封装线程体为 Message 中的 callback<span style=color:#960050;background-color:#1e0010>，</span>再传递至 Looper 中的 MessageQueue
                <span style=color:#66d9ef>break</span><span style=color:#f92672>;</span>
            <span style=color:#66d9ef>case</span> R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>button2</span><span style=color:#f92672>:</span>
                mHandler<span style=color:#f92672>.</span><span style=color:#a6e22e>removeCallbacksAndMessages</span><span style=color:#f92672>(</span><span style=color:#66d9ef>null</span><span style=color:#f92672>);</span>     移除 Looper 中的 MessageQueue 中所有等待处理的 Message
                <span style=color:#66d9ef>break</span><span style=color:#f92672>;</span>
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>

    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onClick</span><span style=color:#f92672>(</span>View view<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>     B
        <span style=color:#a6e22e>switch</span> <span style=color:#f92672>(</span>view<span style=color:#f92672>.</span><span style=color:#a6e22e>getId</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
            <span style=color:#66d9ef>case</span> R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>button1</span><span style=color:#f92672>:</span>
                mThread<span style=color:#f92672>.</span><span style=color:#a6e22e>start</span><span style=color:#f92672>();</span>     启动线程
                <span style=color:#66d9ef>break</span><span style=color:#f92672>;</span>
            <span style=color:#66d9ef>case</span> R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>button2</span><span style=color:#f92672>:</span>
                mThread<span style=color:#f92672>.</span><span style=color:#a6e22e>interrupt</span><span style=color:#f92672>();</span>     中断线程
                <span style=color:#66d9ef>break</span><span style=color:#f92672>;</span>
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><h3 id=activity_mainxml>activity_main.xml</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;LinearLayout</span>
        <span style=color:#a6e22e>xmlns:android=</span><span style=color:#e6db74>&#34;http://schemas.android.com/apk/res/android&#34;</span>
        <span style=color:#a6e22e>android:orientation=</span><span style=color:#e6db74>&#34;vertical&#34;</span>
        <span style=color:#a6e22e>android:padding=</span><span style=color:#e6db74>&#34;16dp&#34;</span>
        <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
        <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;match_parent&#34;</span><span style=color:#f92672>&gt;</span>
    <span style=color:#f92672>&lt;ImageView</span>
            <span style=color:#a6e22e>android:layout_gravity=</span><span style=color:#e6db74>&#34;center&#34;</span>
            <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;150dp&#34;</span>
            <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;150dp&#34;</span>
            <span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/imageView&#34;</span><span style=color:#f92672>/&gt;</span>
    <span style=color:#f92672>&lt;Button</span>
            <span style=color:#a6e22e>android:onClick=</span><span style=color:#e6db74>&#34;onClick&#34;</span>
            <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
            <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
            <span style=color:#a6e22e>android:text=</span><span style=color:#e6db74>&#34;开始&#34;</span>
            <span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/button1&#34;</span><span style=color:#f92672>/&gt;</span>
    <span style=color:#f92672>&lt;Button</span>
            <span style=color:#a6e22e>android:onClick=</span><span style=color:#e6db74>&#34;onClick&#34;</span>
            <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
            <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
            <span style=color:#a6e22e>android:text=</span><span style=color:#e6db74>&#34;停止&#34;</span>
            <span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/button2&#34;</span><span style=color:#f92672>/&gt;</span>
<span style=color:#f92672>&lt;/LinearLayout&gt;</span>
</code></pre></div><h2 id=sendmessage--message>sendMessage ➜ Message</h2><h3 id=mainactivityjava-1>MainActivity.java</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MainActivity</span> <span style=color:#66d9ef>extends</span> Activity <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>private</span> TextView mTextView<span style=color:#f92672>;</span>
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Handler mHandler <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Handler<span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> Handler<span style=color:#f92672>.</span><span style=color:#a6e22e>Callback</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        <span style=color:#a6e22e>@Override</span>
        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>handleMessage</span><span style=color:#f92672>(</span>Message msg<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>     处理 Message<span style=color:#960050;background-color:#1e0010>（</span>主线程<span style=color:#960050;background-color:#1e0010>）</span>
            mTextView<span style=color:#f92672>.</span><span style=color:#a6e22e>setText</span><span style=color:#f92672>(</span>1 <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;:&#34;</span> <span style=color:#f92672>+</span> msg<span style=color:#f92672>.</span><span style=color:#a6e22e>what</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;:&#34;</span> <span style=color:#f92672>+</span> msg<span style=color:#f92672>.</span><span style=color:#a6e22e>arg1</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;:&#34;</span> <span style=color:#f92672>+</span> msg<span style=color:#f92672>.</span><span style=color:#a6e22e>arg2</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;:&#34;</span> <span style=color:#f92672>+</span> msg<span style=color:#f92672>.</span><span style=color:#a6e22e>obj</span><span style=color:#f92672>);</span>
            <span style=color:#66d9ef>return</span> msg<span style=color:#f92672>.</span><span style=color:#a6e22e>what</span> <span style=color:#f92672>!=</span> 0<span style=color:#f92672>;</span>     <span style=color:#66d9ef>true</span> 代表拦截<span style=color:#960050;background-color:#1e0010>（</span>不传递<span style=color:#960050;background-color:#1e0010>），</span><span style=color:#66d9ef>false</span> 代表不拦截<span style=color:#960050;background-color:#1e0010>（</span>传递<span style=color:#960050;background-color:#1e0010>）</span>
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>})</span> <span style=color:#f92672>{</span>
        <span style=color:#a6e22e>@Override</span>
        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>handleMessage</span><span style=color:#f92672>(</span>Message msg<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>     处理 Message<span style=color:#960050;background-color:#1e0010>（</span>主线程<span style=color:#960050;background-color:#1e0010>）</span>
            mTextView<span style=color:#f92672>.</span><span style=color:#a6e22e>setText</span><span style=color:#f92672>(</span>2 <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;:&#34;</span> <span style=color:#f92672>+</span> msg<span style=color:#f92672>.</span><span style=color:#a6e22e>what</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;:&#34;</span> <span style=color:#f92672>+</span> msg<span style=color:#f92672>.</span><span style=color:#a6e22e>arg1</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;:&#34;</span> <span style=color:#f92672>+</span> msg<span style=color:#f92672>.</span><span style=color:#a6e22e>arg2</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;:&#34;</span> <span style=color:#f92672>+</span> msg<span style=color:#f92672>.</span><span style=color:#a6e22e>obj</span><span style=color:#f92672>);</span>
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>};</span>

    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onCreate</span><span style=color:#f92672>(</span>Bundle savedInstanceState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onCreate</span><span style=color:#f92672>(</span>savedInstanceState<span style=color:#f92672>);</span>
        setContentView<span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>layout</span><span style=color:#f92672>.</span><span style=color:#a6e22e>activity_main</span><span style=color:#f92672>);</span>

        mTextView <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>TextView<span style=color:#f92672>)</span> findViewById<span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>textView</span><span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>

    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onDestroy</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onDestroy</span><span style=color:#f92672>();</span>
        mHandler<span style=color:#f92672>.</span><span style=color:#a6e22e>removeCallbacksAndMessages</span><span style=color:#f92672>(</span><span style=color:#66d9ef>null</span><span style=color:#f92672>);</span>     移除 Looper 中的 MessageQueue 中所有等待处理的 Message
    <span style=color:#f92672>}</span>

    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onClick</span><span style=color:#f92672>(</span>View view<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>switch</span> <span style=color:#f92672>(</span>view<span style=color:#f92672>.</span><span style=color:#a6e22e>getId</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
            <span style=color:#66d9ef>case</span> R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>button</span><span style=color:#f92672>:</span>
                <span style=color:#66d9ef>new</span> Thread<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
                    <span style=color:#a6e22e>@Override</span>
                    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>run</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
                        第一种
                        Message message <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Message<span style=color:#f92672>();</span>
                        message<span style=color:#f92672>.</span><span style=color:#a6e22e>what</span> <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span>
                        message<span style=color:#f92672>.</span><span style=color:#a6e22e>arg1</span> <span style=color:#f92672>=</span> 123<span style=color:#f92672>;</span>
                        message<span style=color:#f92672>.</span><span style=color:#a6e22e>arg2</span> <span style=color:#f92672>=</span> 456<span style=color:#f92672>;</span>
                        message<span style=color:#f92672>.</span><span style=color:#a6e22e>obj</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;你好&#34;</span><span style=color:#f92672>;</span>
                        mHandler<span style=color:#f92672>.</span><span style=color:#a6e22e>sendMessage</span><span style=color:#f92672>(</span>message<span style=color:#f92672>);</span>     传递至 Looper 中的 MessageQueue<span style=color:#960050;background-color:#1e0010>，</span>再发送给对应的 Handler 对象处理

                        第二种<span style=color:#960050;background-color:#1e0010>（</span>推荐<span style=color:#960050;background-color:#1e0010>）</span>
                        Message message <span style=color:#f92672>=</span> mHandler<span style=color:#f92672>.</span><span style=color:#a6e22e>obtainMessage</span><span style=color:#f92672>(</span>0<span style=color:#f92672>,</span> 123<span style=color:#f92672>,</span> 456<span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;你好&#34;</span><span style=color:#f92672>);</span>     重用 Message
                        message<span style=color:#f92672>.</span><span style=color:#a6e22e>sendToTarget</span><span style=color:#f92672>();</span>     传递至 Looper 中的 MessageQueue<span style=color:#960050;background-color:#1e0010>，</span>再发送给对应的 Handler 对象处理
                    <span style=color:#f92672>}</span>
                <span style=color:#f92672>}.</span><span style=color:#a6e22e>start</span><span style=color:#f92672>();</span>     启动线程
                <span style=color:#66d9ef>break</span><span style=color:#f92672>;</span>
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><h3 id=activity_mainxml-1>activity_main.xml</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;LinearLayout</span>
        <span style=color:#a6e22e>xmlns:android=</span><span style=color:#e6db74>&#34;http://schemas.android.com/apk/res/android&#34;</span>
        <span style=color:#a6e22e>android:orientation=</span><span style=color:#e6db74>&#34;vertical&#34;</span>
        <span style=color:#a6e22e>android:padding=</span><span style=color:#e6db74>&#34;16dp&#34;</span>
        <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
        <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;match_parent&#34;</span><span style=color:#f92672>&gt;</span>
    <span style=color:#f92672>&lt;Button</span>
            <span style=color:#a6e22e>android:onClick=</span><span style=color:#e6db74>&#34;onClick&#34;</span>
            <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
            <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
            <span style=color:#a6e22e>android:text=</span><span style=color:#e6db74>&#34;发送&#34;</span>
            <span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/button&#34;</span><span style=color:#f92672>/&gt;</span>
    <span style=color:#f92672>&lt;TextView</span>
            <span style=color:#a6e22e>android:gravity=</span><span style=color:#e6db74>&#34;center&#34;</span>
            <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
            <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
            <span style=color:#a6e22e>android:text=</span><span style=color:#e6db74>&#34;New Text&#34;</span>
            <span style=color:#a6e22e>android:textSize=</span><span style=color:#e6db74>&#34;20sp&#34;</span>
            <span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/textView&#34;</span><span style=color:#f92672>/&gt;</span>
<span style=color:#f92672>&lt;/LinearLayout&gt;</span>
</code></pre></div><h2 id=防止-handler-导致内存泄漏>防止 Handler 导致内存泄漏</h2><ul><li>导致原因：<ul><li>非静态的内部类默认持有其外部类的强引用。</li><li>Handler 对象发送的 Message 对象会持有此 Handler 对象的引用。</li><li>Message ➜ Handler ➜ Activity ➜ Activity 资源无法回收（内存泄漏）</li></ul></li><li>解决方案：<ul><li>声明 Handler 为 <code>static</code> 或者使用 <code>Handler.Callback</code> 接口或者为其新建类文件。</li><li>通过弱引用持有外部 Activity。</li></ul></li><li>弱引用：只持有弱引用的对象随时都会被回收，用于避免内存泄漏。（WeakReference）</li><li>软引用：只持有软引用的对象内存不足时回收，用于实现缓存机制。（SoftReference）</li><li>引用级别：强引用 > 软引用 > 弱引用 > 虚引用</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MainActivity</span> <span style=color:#66d9ef>extends</span> Activity <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> Runnable mRunnable <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Runnable<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>     静态匿名内部类
        <span style=color:#a6e22e>@Override</span>
        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>run</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
            Log<span style=color:#f92672>.</span><span style=color:#a6e22e>w</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Tag&#34;</span><span style=color:#f92672>,</span> Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>currentThread</span><span style=color:#f92672>().</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>());</span>
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>};</span>
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> MyHandler mMyHandler <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MyHandler<span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>);</span>
    <span style=color:#66d9ef>private</span> TextView mTextView<span style=color:#f92672>;</span>

    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onCreate</span><span style=color:#f92672>(</span>Bundle savedInstanceState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onCreate</span><span style=color:#f92672>(</span>savedInstanceState<span style=color:#f92672>);</span>
        setContentView<span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>layout</span><span style=color:#f92672>.</span><span style=color:#a6e22e>activity_main</span><span style=color:#f92672>);</span>

        mTextView <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>TextView<span style=color:#f92672>)</span> findViewById<span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>textView</span><span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>

    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onDestroy</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onDestroy</span><span style=color:#f92672>();</span>
        mHandler<span style=color:#f92672>.</span><span style=color:#a6e22e>removeCallbacksAndMessages</span><span style=color:#f92672>(</span><span style=color:#66d9ef>null</span><span style=color:#f92672>);</span>     移除 Looper 中的 MessageQueue 中所有等待处理的 Message
    <span style=color:#f92672>}</span>

    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onClick</span><span style=color:#f92672>(</span>View view<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>switch</span> <span style=color:#f92672>(</span>view<span style=color:#f92672>.</span><span style=color:#a6e22e>getId</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
            <span style=color:#66d9ef>case</span> R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>button</span><span style=color:#f92672>:</span>
                <span style=color:#66d9ef>new</span> Thread<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
                    <span style=color:#a6e22e>@Override</span>
                    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>run</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
                        Message message <span style=color:#f92672>=</span> mMyHandler<span style=color:#f92672>.</span><span style=color:#a6e22e>obtainMessage</span><span style=color:#f92672>(</span>0<span style=color:#f92672>,</span> 123<span style=color:#f92672>,</span> 456<span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;你好&#34;</span><span style=color:#f92672>);</span>
                        mMyHandler<span style=color:#f92672>.</span><span style=color:#a6e22e>sendMessage</span><span style=color:#f92672>(</span>message<span style=color:#f92672>);</span>     传递至 Looper 中的 MessageQueue<span style=color:#960050;background-color:#1e0010>，</span>再发送给对应的 Handler 对象处理
                        mMyHandler<span style=color:#f92672>.</span><span style=color:#a6e22e>post</span><span style=color:#f92672>(</span>mRunnable<span style=color:#f92672>);</span>     封装线程体为 Message 中的 callback<span style=color:#960050;background-color:#1e0010>，</span>再传递至 Looper 中的 MessageQueue
                    <span style=color:#f92672>}</span>
                <span style=color:#f92672>}.</span><span style=color:#a6e22e>start</span><span style=color:#f92672>();</span>     启动线程
                <span style=color:#66d9ef>break</span><span style=color:#f92672>;</span>
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>

    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyHandler</span> <span style=color:#66d9ef>extends</span> Handler <span style=color:#f92672>{</span>     静态内部类
        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> WeakReference<span style=color:#f92672>&lt;</span>MainActivity<span style=color:#f92672>&gt;</span> mActivity<span style=color:#f92672>;</span>     通过弱引用持有外部 Activity

        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>MyHandler</span><span style=color:#f92672>(</span>MainActivity activity<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>     构造方法
            mActivity <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> WeakReference<span style=color:#f92672>&lt;&gt;(</span>activity<span style=color:#f92672>);</span>
        <span style=color:#f92672>}</span>

        <span style=color:#a6e22e>@Override</span>
        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>handleMessage</span><span style=color:#f92672>(</span>Message msg<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
            MainActivity mainActivity <span style=color:#f92672>=</span> mActivity<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>();</span>
            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mainActivity <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>     如果不为空
                mainActivity<span style=color:#f92672>.</span><span style=color:#a6e22e>mTextView</span><span style=color:#f92672>.</span><span style=color:#a6e22e>setText</span><span style=color:#f92672>(</span>msg<span style=color:#f92672>.</span><span style=color:#a6e22e>what</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;:&#34;</span> <span style=color:#f92672>+</span> msg<span style=color:#f92672>.</span><span style=color:#a6e22e>arg1</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;:&#34;</span> <span style=color:#f92672>+</span> msg<span style=color:#f92672>.</span><span style=color:#a6e22e>arg2</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;:&#34;</span> <span style=color:#f92672>+</span> msg<span style=color:#f92672>.</span><span style=color:#a6e22e>obj</span><span style=color:#f92672>);</span>
            <span style=color:#f92672>}</span>
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><h2 id=自定义-looper-线程>自定义 Looper 线程</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MainActivity</span> <span style=color:#66d9ef>extends</span> Activity <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> MyHandler mMyHandler <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MyHandler<span style=color:#f92672>();</span>     与主线程进行关联

    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onCreate</span><span style=color:#f92672>(</span>Bundle savedInstanceState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onCreate</span><span style=color:#f92672>(</span>savedInstanceState<span style=color:#f92672>);</span>
        setContentView<span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>layout</span><span style=color:#f92672>.</span><span style=color:#a6e22e>activity_main</span><span style=color:#f92672>);</span>

        mMyHandler<span style=color:#f92672>.</span><span style=color:#a6e22e>sendEmptyMessage</span><span style=color:#f92672>(</span>1<span style=color:#f92672>);</span>     Message 在主线程进行处理

        MyThread myThread <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MyThread<span style=color:#f92672>();</span>
        myThread<span style=color:#f92672>.</span><span style=color:#a6e22e>start</span><span style=color:#f92672>();</span>     启动线程
        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
            Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span>100<span style=color:#f92672>);</span>     阻塞 0<span style=color:#f92672>.</span><span style=color:#a6e22e>1</span> 秒<span style=color:#960050;background-color:#1e0010>，</span>等待线程体实例化 mMyHandler<span style=color:#960050;background-color:#1e0010>，</span>避免空指针异常
        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>InterruptedException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
            e<span style=color:#f92672>.</span><span style=color:#a6e22e>printStackTrace</span><span style=color:#f92672>();</span>
        <span style=color:#f92672>}</span>
        myThread<span style=color:#f92672>.</span><span style=color:#a6e22e>mMyHandler</span><span style=color:#f92672>.</span><span style=color:#a6e22e>sendEmptyMessage</span><span style=color:#f92672>(</span>2<span style=color:#f92672>);</span>     Message 在子线程进行处理
    <span style=color:#f92672>}</span>

    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyThread</span> <span style=color:#66d9ef>extends</span> Thread <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>private</span> MyHandler mMyHandler<span style=color:#f92672>;</span>

        <span style=color:#a6e22e>@Override</span>
        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>run</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
            Looper<span style=color:#f92672>.</span><span style=color:#a6e22e>prepare</span><span style=color:#f92672>();</span>     为当前线程创建 Looper 并与之绑定
            mMyHandler <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MyHandler<span style=color:#f92672>();</span>          与子线程进行关联<span style=color:#960050;background-color:#1e0010>（</span>实例化 Handler 的同时会自动绑定当前线程的 Looper<span style=color:#960050;background-color:#1e0010>）</span>
            Looper<span style=color:#f92672>.</span><span style=color:#a6e22e>loop</span><span style=color:#f92672>();</span>     Looper 开始工作<span style=color:#960050;background-color:#1e0010>，</span>无限循环<span style=color:#960050;background-color:#1e0010>，</span>阻塞方法
        <span style=color:#f92672>}</span>

        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>stopLoop</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
            Looper<span style=color:#f92672>.</span><span style=color:#a6e22e>myLooper</span><span style=color:#f92672>().</span><span style=color:#a6e22e>quitSafely</span><span style=color:#f92672>();</span>     Looper 停止工作
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>

    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyHandler</span> <span style=color:#66d9ef>extends</span> Handler <span style=color:#f92672>{</span>     静态内部类
        <span style=color:#a6e22e>@Override</span>
        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>handleMessage</span><span style=color:#f92672>(</span>Message msg<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
            Log<span style=color:#f92672>.</span><span style=color:#a6e22e>w</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Tag&#34;</span><span style=color:#f92672>,</span> msg<span style=color:#f92672>.</span><span style=color:#a6e22e>what</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;::&#34;</span> <span style=color:#f92672>+</span> Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>currentThread</span><span style=color:#f92672>().</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>());</span>
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
<span style=color:#f92672>----</span>
输出<span style=color:#960050;background-color:#1e0010>：</span>
21106<span style=color:#f92672>-</span>21387<span style=color:#f92672>/</span>com<span style=color:#f92672>.</span><span style=color:#a6e22e>example</span><span style=color:#f92672>.</span><span style=color:#a6e22e>myapp</span><span style=color:#f92672>.</span><span style=color:#a6e22e>myapplication</span> W<span style=color:#f92672>/</span>Tag<span style=color:#f92672>:</span> 2<span style=color:#f92672>::</span>Thread<span style=color:#f92672>[</span>Thread<span style=color:#f92672>-</span>214<span style=color:#f92672>,</span>5<span style=color:#f92672>,</span>main<span style=color:#f92672>]</span>
21106<span style=color:#f92672>-</span>21106<span style=color:#f92672>/</span>com<span style=color:#f92672>.</span><span style=color:#a6e22e>example</span><span style=color:#f92672>.</span><span style=color:#a6e22e>myapp</span><span style=color:#f92672>.</span><span style=color:#a6e22e>myapplication</span> W<span style=color:#f92672>/</span>Tag<span style=color:#f92672>:</span> 1<span style=color:#f92672>::</span>Thread<span style=color:#f92672>[</span>main<span style=color:#f92672>,</span>5<span style=color:#f92672>,</span>main<span style=color:#f92672>]</span>
</code></pre></div><h3 id=handlerthread>HandlerThread</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MainActivity</span> <span style=color:#66d9ef>extends</span> Activity <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> HandlerThread mHandlerThread <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HandlerThread<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;123&#34;</span><span style=color:#f92672>);</span>     已封装好的 Looper 线程<span style=color:#960050;background-color:#1e0010>，</span>推荐这种方式
    <span style=color:#66d9ef>private</span> MyHandler mMyHandler1<span style=color:#f92672>;</span>
    <span style=color:#66d9ef>private</span> MyHandler mMyHandler2<span style=color:#f92672>;</span>

    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onCreate</span><span style=color:#f92672>(</span>Bundle savedInstanceState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onCreate</span><span style=color:#f92672>(</span>savedInstanceState<span style=color:#f92672>);</span>
        setContentView<span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>layout</span><span style=color:#f92672>.</span><span style=color:#a6e22e>activity_main</span><span style=color:#f92672>);</span>

        mMyHandler1 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MyHandler<span style=color:#f92672>();</span>     无参构造方法
        mMyHandler1<span style=color:#f92672>.</span><span style=color:#a6e22e>sendEmptyMessage</span><span style=color:#f92672>(</span>0<span style=color:#f92672>);</span>     Message 在主线程进行处理

        mHandlerThread<span style=color:#f92672>.</span><span style=color:#a6e22e>start</span><span style=color:#f92672>();</span>     启动线程
        mMyHandler2 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MyHandler<span style=color:#f92672>(</span>mHandlerThread<span style=color:#f92672>.</span><span style=color:#a6e22e>getLooper</span><span style=color:#f92672>());</span>     有参构造方法
        mMyHandler2<span style=color:#f92672>.</span><span style=color:#a6e22e>sendEmptyMessage</span><span style=color:#f92672>(</span>0<span style=color:#f92672>);</span>     Message 在子线程进行处理
    <span style=color:#f92672>}</span>

    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyHandler</span> <span style=color:#66d9ef>extends</span> Handler <span style=color:#f92672>{</span>     静态内部类
        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>MyHandler</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>     无参构造方法<span style=color:#960050;background-color:#1e0010>（</span>实例化 Handler 的同时会自动绑定当前线程的 Looper<span style=color:#960050;background-color:#1e0010>）</span>
        <span style=color:#f92672>}</span>

        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>MyHandler</span><span style=color:#f92672>(</span>Looper looper<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>     有参构造方法<span style=color:#960050;background-color:#1e0010>（</span>指定 Looper 对象<span style=color:#960050;background-color:#1e0010>）</span>
            <span style=color:#66d9ef>super</span><span style=color:#f92672>(</span>looper<span style=color:#f92672>);</span>
        <span style=color:#f92672>}</span>

        <span style=color:#a6e22e>@Override</span>
        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>handleMessage</span><span style=color:#f92672>(</span>Message msg<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
            Log<span style=color:#f92672>.</span><span style=color:#a6e22e>w</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Tag&#34;</span><span style=color:#f92672>,</span> msg<span style=color:#f92672>.</span><span style=color:#a6e22e>what</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;::&#34;</span> <span style=color:#f92672>+</span> Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>currentThread</span><span style=color:#f92672>().</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>());</span>
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
<span style=color:#f92672>----</span>
输出<span style=color:#960050;background-color:#1e0010>：</span>
2853<span style=color:#f92672>-</span>4062<span style=color:#f92672>/</span>com<span style=color:#f92672>.</span><span style=color:#a6e22e>example</span><span style=color:#f92672>.</span><span style=color:#a6e22e>myapp</span><span style=color:#f92672>.</span><span style=color:#a6e22e>myapplication</span> W<span style=color:#f92672>/</span>Tag<span style=color:#f92672>:</span> 0<span style=color:#f92672>::</span>Thread<span style=color:#f92672>[</span>123<span style=color:#f92672>,</span>5<span style=color:#f92672>,</span>main<span style=color:#f92672>]</span>
2853<span style=color:#f92672>-</span>2853<span style=color:#f92672>/</span>com<span style=color:#f92672>.</span><span style=color:#a6e22e>example</span><span style=color:#f92672>.</span><span style=color:#a6e22e>myapp</span><span style=color:#f92672>.</span><span style=color:#a6e22e>myapplication</span> W<span style=color:#f92672>/</span>Tag<span style=color:#f92672>:</span> 0<span style=color:#f92672>::</span>Thread<span style=color:#f92672>[</span>main<span style=color:#f92672>,</span>5<span style=color:#f92672>,</span>main<span style=color:#f92672>]</span>
</code></pre></div><h2 id=线程之间的交互>线程之间的交互</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MainActivity</span> <span style=color:#66d9ef>extends</span> Activity <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> HandlerThread mHandlerThread <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HandlerThread<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;123&#34;</span><span style=color:#f92672>);</span>
    <span style=color:#66d9ef>private</span> MyHandler mMyHandler1<span style=color:#f92672>;</span>
    <span style=color:#66d9ef>private</span> MyHandler mMyHandler2<span style=color:#f92672>;</span>

    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onCreate</span><span style=color:#f92672>(</span>Bundle savedInstanceState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onCreate</span><span style=color:#f92672>(</span>savedInstanceState<span style=color:#f92672>);</span>
        setContentView<span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>layout</span><span style=color:#f92672>.</span><span style=color:#a6e22e>activity_main</span><span style=color:#f92672>);</span>

        mHandlerThread<span style=color:#f92672>.</span><span style=color:#a6e22e>start</span><span style=color:#f92672>();</span>     启动线程

        mMyHandler1 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MyHandler<span style=color:#f92672>();</span>     绑定主线程 Looper
        mMyHandler2 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MyHandler<span style=color:#f92672>(</span>mHandlerThread<span style=color:#f92672>.</span><span style=color:#a6e22e>getLooper</span><span style=color:#f92672>());</span>     绑定子线程 Looper
    <span style=color:#f92672>}</span>

    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onClick</span><span style=color:#f92672>(</span>View view<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>switch</span> <span style=color:#f92672>(</span>view<span style=color:#f92672>.</span><span style=color:#a6e22e>getId</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
            <span style=color:#66d9ef>case</span> R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>button1</span><span style=color:#f92672>:</span>
                Message message1 <span style=color:#f92672>=</span> mMyHandler1<span style=color:#f92672>.</span><span style=color:#a6e22e>obtainMessage</span><span style=color:#f92672>(</span>1<span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;主线程发往子线程&#34;</span><span style=color:#f92672>);</span>
                message1<span style=color:#f92672>.</span><span style=color:#a6e22e>setTarget</span><span style=color:#f92672>(</span>mMyHandler2<span style=color:#f92672>);</span>     指定目标 Handler
                message1<span style=color:#f92672>.</span><span style=color:#a6e22e>sendToTarget</span><span style=color:#f92672>();</span>     传递至 Looper 中的 MessageQueue<span style=color:#960050;background-color:#1e0010>，</span>再发送给对应的 Handler 对象处理
                <span style=color:#66d9ef>break</span><span style=color:#f92672>;</span>
            <span style=color:#66d9ef>case</span> R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>button2</span><span style=color:#f92672>:</span>
                Message message2 <span style=color:#f92672>=</span> mMyHandler2<span style=color:#f92672>.</span><span style=color:#a6e22e>obtainMessage</span><span style=color:#f92672>(</span>2<span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;子线程发往主线程&#34;</span><span style=color:#f92672>);</span>
                message2<span style=color:#f92672>.</span><span style=color:#a6e22e>setTarget</span><span style=color:#f92672>(</span>mMyHandler1<span style=color:#f92672>);</span>     指定目标 Handler
                message2<span style=color:#f92672>.</span><span style=color:#a6e22e>sendToTarget</span><span style=color:#f92672>();</span>     传递至 Looper 中的 MessageQueue<span style=color:#960050;background-color:#1e0010>，</span>再发送给对应的 Handler 对象处理
                <span style=color:#66d9ef>break</span><span style=color:#f92672>;</span>
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>

    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyHandler</span> <span style=color:#66d9ef>extends</span> Handler <span style=color:#f92672>{</span>     静态内部类
        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>MyHandler</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>     无参构造方法<span style=color:#960050;background-color:#1e0010>（</span>实例化 Handler 的同时会自动绑定当前线程的 Looper<span style=color:#960050;background-color:#1e0010>）</span>
        <span style=color:#f92672>}</span>

        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>MyHandler</span><span style=color:#f92672>(</span>Looper looper<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>     有参构造方法<span style=color:#960050;background-color:#1e0010>（</span>指定 Looper 对象<span style=color:#960050;background-color:#1e0010>）</span>
            <span style=color:#66d9ef>super</span><span style=color:#f92672>(</span>looper<span style=color:#f92672>);</span>
        <span style=color:#f92672>}</span>

        <span style=color:#a6e22e>@Override</span>
        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>handleMessage</span><span style=color:#f92672>(</span>Message msg<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
            Log<span style=color:#f92672>.</span><span style=color:#a6e22e>w</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Tag&#34;</span><span style=color:#f92672>,</span> msg<span style=color:#f92672>.</span><span style=color:#a6e22e>what</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;::&#34;</span> <span style=color:#f92672>+</span> msg<span style=color:#f92672>.</span><span style=color:#a6e22e>obj</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;::&#34;</span> <span style=color:#f92672>+</span> Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>currentThread</span><span style=color:#f92672>().</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>());</span>
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
<span style=color:#f92672>----</span>
输出<span style=color:#960050;background-color:#1e0010>：</span>
15749<span style=color:#f92672>-</span>18518<span style=color:#f92672>/</span>com<span style=color:#f92672>.</span><span style=color:#a6e22e>example</span><span style=color:#f92672>.</span><span style=color:#a6e22e>myapp</span><span style=color:#f92672>.</span><span style=color:#a6e22e>myapplication</span> W<span style=color:#f92672>/</span>Tag<span style=color:#f92672>:</span> 1<span style=color:#f92672>::</span>主线程发往子线程<span style=color:#f92672>::</span>Thread<span style=color:#f92672>[</span>123<span style=color:#f92672>,</span>5<span style=color:#f92672>,</span>main<span style=color:#f92672>]</span>
15749<span style=color:#f92672>-</span>15749<span style=color:#f92672>/</span>com<span style=color:#f92672>.</span><span style=color:#a6e22e>example</span><span style=color:#f92672>.</span><span style=color:#a6e22e>myapp</span><span style=color:#f92672>.</span><span style=color:#a6e22e>myapplication</span> W<span style=color:#f92672>/</span>Tag<span style=color:#f92672>:</span> 2<span style=color:#f92672>::</span>子线程发往主线程<span style=color:#f92672>::</span>Thread<span style=color:#f92672>[</span>main<span style=color:#f92672>,</span>5<span style=color:#f92672>,</span>main<span style=color:#f92672>]</span>
</code></pre></div><h2 id=更新-ui-的-4-种方式>更新 UI 的 4 种方式</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MainActivity</span> <span style=color:#66d9ef>extends</span> Activity <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> MyHandler mMyHandler <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MyHandler<span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>);</span>
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> MyRunnable mMyRunnable <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MyRunnable<span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>);</span>
    <span style=color:#66d9ef>private</span> TextView mTextView<span style=color:#f92672>;</span>

    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onCreate</span><span style=color:#f92672>(</span>Bundle savedInstanceState<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onCreate</span><span style=color:#f92672>(</span>savedInstanceState<span style=color:#f92672>);</span>
        setContentView<span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>layout</span><span style=color:#f92672>.</span><span style=color:#a6e22e>activity_main</span><span style=color:#f92672>);</span>

        mTextView <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>TextView<span style=color:#f92672>)</span> findViewById<span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>textView</span><span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>

    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onClick</span><span style=color:#f92672>(</span>View view<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>     这 4 种方法本质上都是通过 Handler 机制而运行在主线程
        <span style=color:#a6e22e>switch</span> <span style=color:#f92672>(</span>view<span style=color:#f92672>.</span><span style=color:#a6e22e>getId</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
            <span style=color:#66d9ef>case</span> R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>button1</span><span style=color:#f92672>:</span>
                <span style=color:#66d9ef>new</span> Thread<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
                    <span style=color:#a6e22e>@Override</span>
                    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>run</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
                        mMyHandler<span style=color:#f92672>.</span><span style=color:#a6e22e>obtainMessage</span><span style=color:#f92672>(</span>1<span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;你好&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>sendToTarget</span><span style=color:#f92672>();</span>     Handler 方法 sendMessage
                    <span style=color:#f92672>}</span>
                <span style=color:#f92672>}.</span><span style=color:#a6e22e>start</span><span style=color:#f92672>();</span>     启动新线程
                <span style=color:#66d9ef>break</span><span style=color:#f92672>;</span>
            <span style=color:#66d9ef>case</span> R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>button2</span><span style=color:#f92672>:</span>
                <span style=color:#66d9ef>new</span> Thread<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
                    <span style=color:#a6e22e>@Override</span>
                    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>run</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
                        mMyHandler<span style=color:#f92672>.</span><span style=color:#a6e22e>post</span><span style=color:#f92672>(</span>mMyRunnable<span style=color:#f92672>);</span>     Handler 方法 post
                    <span style=color:#f92672>}</span>
                <span style=color:#f92672>}.</span><span style=color:#a6e22e>start</span><span style=color:#f92672>();</span>     启动新线程
                <span style=color:#66d9ef>break</span><span style=color:#f92672>;</span>
            <span style=color:#66d9ef>case</span> R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>button3</span><span style=color:#f92672>:</span>
                <span style=color:#66d9ef>new</span> Thread<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
                    <span style=color:#a6e22e>@Override</span>
                    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>run</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
                        mTextView<span style=color:#f92672>.</span><span style=color:#a6e22e>post</span><span style=color:#f92672>(</span>mMyRunnable<span style=color:#f92672>);</span>     View 方法 post
                    <span style=color:#f92672>}</span>
                <span style=color:#f92672>}.</span><span style=color:#a6e22e>start</span><span style=color:#f92672>();</span>     启动新线程
                <span style=color:#66d9ef>break</span><span style=color:#f92672>;</span>
            <span style=color:#66d9ef>case</span> R<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>button4</span><span style=color:#f92672>:</span>
                <span style=color:#66d9ef>new</span> Thread<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
                    <span style=color:#a6e22e>@Override</span>
                    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>run</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
                        MainActivity<span style=color:#f92672>.</span><span style=color:#a6e22e>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>runOnUiThread</span><span style=color:#f92672>(</span>mMyRunnable<span style=color:#f92672>);</span>     Activity 方法 runOnUiThread
                    <span style=color:#f92672>}</span>
                <span style=color:#f92672>}.</span><span style=color:#a6e22e>start</span><span style=color:#f92672>();</span>     启动新线程
                <span style=color:#66d9ef>break</span><span style=color:#f92672>;</span>
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>

    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyHandler</span> <span style=color:#66d9ef>extends</span> Handler <span style=color:#f92672>{</span>     静态内部类
        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> WeakReference<span style=color:#f92672>&lt;</span>MainActivity<span style=color:#f92672>&gt;</span> mActivity<span style=color:#f92672>;</span>     通过弱引用持有外部 Activity

        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>MyHandler</span><span style=color:#f92672>(</span>MainActivity activity<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>     构造方法
            mActivity <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> WeakReference<span style=color:#f92672>&lt;&gt;(</span>activity<span style=color:#f92672>);</span>
        <span style=color:#f92672>}</span>

        <span style=color:#a6e22e>@Override</span>
        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>handleMessage</span><span style=color:#f92672>(</span>Message msg<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
            Log<span style=color:#f92672>.</span><span style=color:#a6e22e>w</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Tag&#34;</span><span style=color:#f92672>,</span> Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>currentThread</span><span style=color:#f92672>().</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>());</span>     打印当前线程信息
            MainActivity mainActivity <span style=color:#f92672>=</span> mActivity<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>();</span>
            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mainActivity <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>     如果不为空
                mainActivity<span style=color:#f92672>.</span><span style=color:#a6e22e>mTextView</span><span style=color:#f92672>.</span><span style=color:#a6e22e>setText</span><span style=color:#f92672>(</span>msg<span style=color:#f92672>.</span><span style=color:#a6e22e>obj</span><span style=color:#f92672>.</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>());</span>
            <span style=color:#f92672>}</span>
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>

    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyRunnable</span> <span style=color:#66d9ef>implements</span> Runnable <span style=color:#f92672>{</span>     静态内部类
        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> WeakReference<span style=color:#f92672>&lt;</span>MainActivity<span style=color:#f92672>&gt;</span> mActivity<span style=color:#f92672>;</span>     通过弱引用持有外部 Activity

        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>MyRunnable</span><span style=color:#f92672>(</span>MainActivity activity<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>     构造方法
            mActivity <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> WeakReference<span style=color:#f92672>&lt;&gt;(</span>activity<span style=color:#f92672>);</span>
        <span style=color:#f92672>}</span>

        <span style=color:#a6e22e>@Override</span>
        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>run</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
            Log<span style=color:#f92672>.</span><span style=color:#a6e22e>w</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Tag&#34;</span><span style=color:#f92672>,</span> Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>currentThread</span><span style=color:#f92672>().</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>());</span>     打印当前线程信息
            MainActivity mainActivity <span style=color:#f92672>=</span> mActivity<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>();</span>
            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mainActivity <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>     如果不为空
                mainActivity<span style=color:#f92672>.</span><span style=color:#a6e22e>mTextView</span><span style=color:#f92672>.</span><span style=color:#a6e22e>setText</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;你好&#34;</span><span style=color:#f92672>);</span>
            <span style=color:#f92672>}</span>
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
<span style=color:#f92672>----</span>
输出<span style=color:#960050;background-color:#1e0010>：</span>
3974<span style=color:#f92672>-</span>3974<span style=color:#f92672>/</span>com<span style=color:#f92672>.</span><span style=color:#a6e22e>example</span><span style=color:#f92672>.</span><span style=color:#a6e22e>myapp</span><span style=color:#f92672>.</span><span style=color:#a6e22e>myapplication</span> W<span style=color:#f92672>/</span>Tag<span style=color:#f92672>:</span> Thread<span style=color:#f92672>[</span>main<span style=color:#f92672>,</span>5<span style=color:#f92672>,</span>main<span style=color:#f92672>]</span>
3974<span style=color:#f92672>-</span>3974<span style=color:#f92672>/</span>com<span style=color:#f92672>.</span><span style=color:#a6e22e>example</span><span style=color:#f92672>.</span><span style=color:#a6e22e>myapp</span><span style=color:#f92672>.</span><span style=color:#a6e22e>myapplication</span> W<span style=color:#f92672>/</span>Tag<span style=color:#f92672>:</span> Thread<span style=color:#f92672>[</span>main<span style=color:#f92672>,</span>5<span style=color:#f92672>,</span>main<span style=color:#f92672>]</span>
3974<span style=color:#f92672>-</span>3974<span style=color:#f92672>/</span>com<span style=color:#f92672>.</span><span style=color:#a6e22e>example</span><span style=color:#f92672>.</span><span style=color:#a6e22e>myapp</span><span style=color:#f92672>.</span><span style=color:#a6e22e>myapplication</span> W<span style=color:#f92672>/</span>Tag<span style=color:#f92672>:</span> Thread<span style=color:#f92672>[</span>main<span style=color:#f92672>,</span>5<span style=color:#f92672>,</span>main<span style=color:#f92672>]</span>
3974<span style=color:#f92672>-</span>3974<span style=color:#f92672>/</span>com<span style=color:#f92672>.</span><span style=color:#a6e22e>example</span><span style=color:#f92672>.</span><span style=color:#a6e22e>myapp</span><span style=color:#f92672>.</span><span style=color:#a6e22e>myapplication</span> W<span style=color:#f92672>/</span>Tag<span style=color:#f92672>:</span> Thread<span style=color:#f92672>[</span>main<span style=color:#f92672>,</span>5<span style=color:#f92672>,</span>main<span style=color:#f92672>]</span>
</code></pre></div></div><div class=sharing style=text-align:center><br><p>捐赠支持</p><p>如果我的文章对你有所帮助，欢迎通过支付宝的扫一扫，轻松的向我发起捐助。</p><p>对于你的支持，我会心怀感激且倍感荣幸地接受，并继续努力。</p><img src=https://ww4.sinaimg.cn/large/a15b4afegw1fbn096ql6dj20dw0dwwe9.jpg alt title data-action=zoom width=40%><p></p><br>&copy; 2015-2020 XhstormR</div></div></div></div><div id=backtop><a href=# title>TOP</a></div><nav id=TableOfContents><ul><li><a href=#post--runnable>post ➜ Runnable</a><ul><li><a href=#mainactivityjava>MainActivity.java</a></li><li><a href=#activity_mainxml>activity_main.xml</a></li></ul></li><li><a href=#sendmessage--message>sendMessage ➜ Message</a><ul><li><a href=#mainactivityjava-1>MainActivity.java</a></li><li><a href=#activity_mainxml-1>activity_main.xml</a></li></ul></li><li><a href=#防止-handler-导致内存泄漏>防止 Handler 导致内存泄漏</a></li><li><a href=#自定义-looper-线程>自定义 Looper 线程</a><ul><li><a href=#handlerthread>HandlerThread</a></li></ul></li><li><a href=#线程之间的交互>线程之间的交互</a></li><li><a href=#更新-ui-的-4-种方式>更新 UI 的 4 种方式</a></li></ul></nav><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/languages/yaml.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/languages/kotlin.min.js></script><script>hljs.initHighlightingOnLoad()</script><script src=https://blog.xhstormr.tk/js/zoom.min.js></script><script>window.addEventListener("load",show),window.onscroll=show;function show(){document.documentElement.scrollTop+document.body.scrollTop>300?document.getElementById("backtop").style.display="block":document.getElementById("backtop").style.display="none"}</script><script type=text/javascript color=0,0,0 opacity=1 zindex=-2 count=49 src=https://cdnjs.cloudflare.com/ajax/libs/canvas-nest.js/2.0.4/canvas-nest.js></script></body></html>